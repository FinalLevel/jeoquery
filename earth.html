<!DOCTYPE html>
<html lang="en">
<head>
	<title>jeoquery examples</title>

	<link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css"/>
	<link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css"/>
	<link rel="stylesheet" href="jeoquery.css"/>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://static.jstree.com/v.1.0pre/jquery.jstree.js"></script>
	<script type="text/javascript" src="jeoquery.js"></script>
</head>
<body class="container">
	<script type="text/javascript">
	function mapJsTreeNode(obj) {
		var a = [];
		for (var key in obj) {
			var node = { "data": key + "" };
			var nodeContent = obj[key];
			var type = typeof(nodeContent);
			if (type != "object") {
				if (type == "string" ) {
					node["data"] += " = \"" + nodeContent + "\"";
				} else {
					node["data"] += " = " + nodeContent;
				}
				if (key == "geonameId") {
					node["attr"] = { "rel": "world", "id": nodeContent };
					node["state"] = "closed";
				} else {
					node["attr"] = { "rel": "leaf" };
				}
			} else {
				if (Object.prototype.toString.call(nodeContent) === '[object Array]') {
					node["attr"] = { "rel": "application_view_list" };
				} 
				node["children"] = [ mapJsTreeNode(obj[key]) ];
			}
			a.push(node);
		}
		return a;
	}
	function expand(event, data) {
		alert($(this).attr("id"));
	}
	function dbg(data) {
			var treeJSON = mapJsTreeNode(data);

			$("#debug").jstree({
				"json_data" : { "data": treeJSON },
				"plugins": [ "themes", "json_data", "ui" ]
			}).bind("open_node.jstree", expand);
	}
	$(function() {
		jeoquery.userName = 'tompi';

		jeoquery.get(dbg, 6295630);
	});
</script>
    <div class="row">
        <div class="well">
						<span style="font-size: 40px; float: right; padding-top: 20px; color: #363;">GeoNames</span>
						<img src="http://www.geonames.org/img/globe.gif" style="float: right;"/>
						<span style="font-size: 76px; float: right; padding-top: 20px;">+</span>
						<img src="http://jquery.org/wp-content/uploads/2010/01/JQuery_logo_color_onwhite-300x74.png" style="float: right;"/>
            <h2>jeoQuery <small>by Thomas Haukland</small></h2>
						<h3>Browse geonames hierarchy methods</h3>
        </div>
    </div>
    <div class="row">
        <div>
					<h3>Expand something:</h3>
					<div id="debug" class="well"></div>
        </div>
    </div>
</body>

</html>

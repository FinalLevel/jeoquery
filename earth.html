<!DOCTYPE html>
<html lang="en">
<head>
	<title>jeoquery examples</title>

	<link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css"/>
	<link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css"/>
	<link rel="stylesheet" href="jeoquery.css"/>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="http://static.jstree.com/v.1.0pre/jquery.jstree.js"></script>
	<script type="text/javascript" src="jeoquery.js"></script>
</head>
<body class="container">
	<script type="text/javascript">
	function addNode(tree, parentNode, name, id, jsonObject) {
		var position = 'last';
		var data = { attr: { id: id }};
		if (name == 'geonameId') {
			position = 'first';
			data.attr.rel = jsonObject;
			data.state = 'closed';
		}
		var type = typeof(jsonObject);
		if (type != 'object') {			
			name += ' = ';
			if (type == 'string' ) 
				name += '"' + jsonObject + '"';
			else
				name += jsonObject;
		}
		data.data = name;

		tree.jstree('create_node', parentNode, position, data, function() {
			if (type == 'object') {
				var i = 0;
				for (var key in jsonObject) {
					var childId = id + '_' + i;
					addNode(tree, $('#' + id), key, childId, jsonObject[key]);
					i++;
				}
			}
		});
	}
	function expand(event, data) {
		alert($(this).attr("id"));
	}
	function dbg(data) {
			addNode($('#debug'), $('#root'), 'Earth', "0_1", data);
	}
	$(function() {
		jeoquery.userName = 'tompi';

			$("#debug").jstree({
				"plugins": [ "themes", "ui" ,"html_data" ],
			});
			$("#debug").bind("open_node.jstree", function(e, data) {
				var node = data.args[0];
				if (!node.data('openedbefore')) {
					node.data('openedbefore', 'true');
					var rel = node.attr('rel');
					if (rel) {
						jeoquery.children(function(json) {
							addNode($('#debug'), node, 'Children', rel, json);
						}, rel);
					}
				}
			});
		jeoquery.get(dbg, 6295630);
	});
</script>
    <div class="row">
        <div class="well">
						<span style="font-size: 40px; float: right; padding-top: 20px; color: #363;">GeoNames</span>
						<img src="http://www.geonames.org/img/globe.gif" style="float: right;" alt="Geonames logo"/>
						<span style="font-size: 76px; float: right; padding-top: 20px;">+</span>
						<img src="http://jquery.org/wp-content/uploads/2010/01/JQuery_logo_color_onwhite-300x74.png" style="float: right;" alt="jQuery logo"/>
            <h2>jeoQuery <small>by Thomas Haukland</small></h2>
						<h3>Browse geonames hierarchy methods</h3>
        </div>
    </div>
    <div class="row">
        <div>
					<h3>Drill down:</h3>
					<div id="debug" class="well"><ul><li id="root"><a href="#">Geonames</a></li></ul></div>
        </div>
    </div>
</body>

</html>
